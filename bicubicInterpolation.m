function o=bicubicInterpolation(g,resizeFactor,imageOutput)
% Can take for granted that reizeFactor is of form 2
    f=double(g);
    originalSize = size(f);
    newSize = originalSize * resizeFactor;
    output = zeros(newSize(1),newSize(2),class(f));
    
    for i=1:2:(newSize(1)-6)
        for j=1:2:(newSize(2)-6)
            % Each time, take out a 8x8 size block
%             
%             f00=f((i+3)/2, (j+3)/2);
%             f01=f((i+3)/2, (j+5)/2);
%             f10=f((i+5)/2, (j+3)/2);
%             f11=f((i+5)/2, (j+5)/2);
%             
%             fx00=(f((i+3)/2, (j+1)/2) + f((i+3)/2, (j+5)/2))/2.0;
%             fx01=(f((i+3)/2, (j+3)/2) + f((i+3)/2, (j+7)/2))/2.0;
%             fx10=(f((i+5)/2, (j+1)/2) + f((i+5)/2, (j+5)/2))/2.0;
%             fx11=(f((i+5)/2, (j+3)/2) + f((i+5)/2, (j+7)/2))/2.0;
%             fy00=(f((i+1)/2, (j+3)/2) + f((i+5)/2, (j+3)/2))/2.0;
%             fy01=(f((i+1)/2, (j+5)/2) + f((i+5)/2, (j+5)/2))/2.0;
%             fy10=(f((i+3)/2, (j+3)/2) + f((i+7)/2, (j+3)/2))/2.0;
%             fy11=(f((i+3)/2, (j+5)/2) + f((i+7)/2, (j+5)/2))/2.0;
%             
%             fxy00=(f((i+5)/2,(j+5)/2) - f((i+5)/2,(j+1)/2) - f((i+1)/2,(j+5)/2) + f((i+1)/2,(j+1)/2))/4.0;
%             fxy01=(f((i+5)/2,(j+7)/2) - f((i+5)/2,(j+3)/2) - f((i+1)/2,(j+7)/2) + f((i+1)/2,(j+3)/2))/4.0;
%             fxy10=(f((i+7)/2,(j+5)/2) - f((i+7)/2,(j+1)/2) - f((i+3)/2,(j+5)/2) + f((i+3)/2,(j+1)/2))/4.0;
%             fxy11=(f((i+7)/2,(j+7)/2) - f((i+7)/2,(j+3)/2) - f((i+3)/2,(j+7)/2) + f((i+3)/2,(j+3)/2))/4.0;
%             
%             F=[f00 f01 fy00 fy01;
%                f10 f11 fy10 fy11;
%                fx00 fx01 fxy00 fxy01;
%                fx10 fx11 fxy10 fxy11];
%            
%             B1=[1 0 0 0;
%               0 0 1 0;
%               -3 3 -2 -1;
%               2 -2 1 1];
%             B2=[1 0 -3 2;
%                0 0 3 -2;
%                0 1 -2 1;
%                0 0 -1 1];
%            
%             A=F * B2;
%             A=B1*A;
            p=[f((i+1)/2,(j+1)/2) f((i+1)/2,(j+3)/2) f((i+1)/2,(j+5)/2) f((i+1)/2,(j+7)/2);
               f((i+3)/2,(j+1)/2) f((i+3)/2,(j+3)/2) f((i+3)/2,(j+5)/2) f((i+3)/2,(j+7)/2);
               f((i+5)/2,(j+1)/2) f((i+5)/2,(j+3)/2) f((i+5)/2,(j+5)/2) f((i+5)/2,(j+7)/2);
               f((i+7)/2,(j+1)/2) f((i+7)/2,(j+3)/2) f((i+7)/2,(j+5)/2) f((i+7)/2,(j+7)/2)];
%             a00=p(2,2);
%             a01=-0.5*p(2,1) + 0.5*p(2,3);
%             a02=p(2,1) - 2.5*p(2,2) + 2*p(2,3) - 0.5*p(2,4);
%             a03=-0.5*p(2,1) + 1.5*p(2,2) - 1.5*p(2,3) + 0.5*p(2,4);
%             a10=-0.5*p(1,2) + 0.5*p(3,2);
%             a11=.25*p(1,1) -.25*p(1,3) - .25*p(3,1) + .25*p(3,3);
%             a12=-.5*p(1,1) + 1.25*p(1,2) - p(1,3) + .25*p(1,4) + .5*p(3,1) - 1.25*p(3,2) + p(3,3) - .25*p(3,4);
%             a13=.25*p(1,1) - .75*p(1,2) + .75*p(1,3) - .25*p(1,4) - .25*p(3,1) + .75*p(3,2) - .75*p(3,3) + .25*p(3,4);

            a00 = p(2,2);
            a01 = -.5*p(2,1) + .5*p(2,3);
            a02 = p(2,1) - 2.5*p(2,2) + 2*p(2,3) - .5*p(2,4);
            a03 = -.5*p(2,1) + 1.5*p(2,2) - 1.5*p(2,3) + .5*p(2,4);
            a10 = -.5*p(1,2) + .5*p(3,2);
            a11 = .25*p(1,1) - .25*p(1,3) - .25*p(3,1) + .25*p(3,3);
            a12 = -.5*p(1,1) + 1.25*p(1,2) - p(1,3) + .25*p(1,4) + .5*p(3,1) - 1.25*p(3,2) + p(3,3) - .25*p(3,4);
            a13 = .25*p(1,1) - .75*p(1,2) + .75*p(1,3) - .25*p(1,4) - .25*p(3,1) + .75*p(3,2) - .75*p(3,3) + .25*p(3,4);
            a20 = p(1,2) - 2.5*p(2,2) + 2*p(3,2) - .5*p(4,2);
            a21 = -.5*p(1,1) + .5*p(1,3) + 1.25*p(2,1) - 1.25*p(2,3) - p(3,1) + p(3,3) + .25*p(4,1) - .25*p(4,3);
            a22 = p(1,1) - 2.5*p(1,2) + 2*p(1,3) - .5*p(1,4) - 2.5*p(2,1) + 6.25*p(2,2) - 5*p(2,3) + 1.25*p(2,4) + 2*p(3,1) - 5*p(3,2) + 4*p(3,3) - p(3,4) - .5*p(4,1) + 1.25*p(4,2) - p(4,3) + .25*p(4,4);
            a23 = -.5*p(1,1) + 1.5*p(1,2) - 1.5*p(1,3) + .5*p(1,4) + 1.25*p(2,1) - 3.75*p(2,2) + 3.75*p(2,3) - 1.25*p(2,4) - p(3,1) + 3*p(3,2) - 3*p(3,3) + p(3,4) + .25*p(4,1) - .75*p(4,2) + .75*p(4,3) - .25*p(4,4);
            a30 = -.5*p(1,2) + 1.5*p(2,2) - 1.5*p(3,2) + .5*p(4,2);
            a31 = .25*p(1,1) - .25*p(1,3) - .75*p(2,1) + .75*p(2,3) + .75*p(3,1) - .75*p(3,3) - .25*p(4,1) + .25*p(4,3);
            a32 = -.5*p(1,1) + 1.25*p(1,2) - p(1,3) + .25*p(1,4) + 1.5*p(2,1) - 3.75*p(2,2) + 3*p(2,3) - .75*p(2,4) - 1.5*p(3,1) + 3.75*p(3,2) - 3*p(3,3) + .75*p(3,4) + .5*p(4,1) - 1.25*p(4,2) + p(4,3) - .25*p(4,4);
            a33 = .25*p(1,1) - .75*p(1,2) + .75*p(1,3) - .25*p(1,4) - .75*p(2,1) + 2.25*p(2,2) - 2.25*p(2,3) + .75*p(2,4) + .75*p(3,1) - 2.25*p(3,2) + 2.25*p(3,3) - .75*p(3,4) - .25*p(4,1) + .75*p(4,2) - .75*p(4,3) + .25*p(4,4);
            
            A=[a00 a01 a02 a03;
               a10 a11 a12 a13;
               a20 a21 a22 a23;
               a30 a31 a32 a33];


            %getBicubicValue(x,y,A);
            for x=0:1:7
                for y=0:1:7
                    if mod(i+x,2)==0 && mod(j+y,2)==0
                        output(i+x,j+y) = f((i+x)/2,(j+y)/2);
                    else
                        output(i+x, j+y) = getBicubicValue(-1+0.42857*x,-1+0.42857*y,A);
                    end
                    %output(i+x, j+y) = getBicubicValue(-1+.5*x,-1+.5*y,A);
                end
            end
        end
    end
    
    output=cast(output,'like',g);
    imwrite(output, imageOutput);
    o=output;
    